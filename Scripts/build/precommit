#! /bin/zsh

local scriptname=$0:A
local parentdir=${scriptname%/precommit}

checkFile() {
  local fname=$1

  shebang=$(head -n1 $fname)
  if [[ $shebang != */bin/zsh* ]]; then
    echo "$fname: wanted shebang == */bin/zsh*, got '$shebang'"
  fi

  # Even though using Bash rules, Zsh is similar enough.
  # Any Zsh-specific irregularities will have accompanying
  # `shellcheck disable` statements inline, or in the .shellcheckrc file
  shellcheck -f gcc -s bash $fname  # | awk '{print "ERROR " $0; }'

  # Format scripts for whitespace and indents
  shFmt -i 2 -ci -w $fname
}

main() {
  # Redirect output to stderr.
  exec 1>&2
  for i in $parentdir/*.sh; do
    local _errs=$(checkFile $i)
    if [[ -n $_errs ]]; then
      echo $_errs
    fi
  done
}

main
