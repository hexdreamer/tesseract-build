#! /bin/zsh

checkFile() {
  local fname=$1

  # Make sure shebang is zsh
  sed -i.bak '1 s/bin\/bash/bin\/zsh/' "$fname"
  rm "${fname}.bak"

  # And if sed didn't work for some reason...
  shebang=$(head -n1 "$fname")
  if [[ $shebang != */bin/zsh* ]]; then
    echo "ERROR $fname: wanted shebang == */bin/zsh*, got '$shebang'"
  fi

  # Even though using Bash rules, Zsh is mostly similar.
  # Any Zsh-specific irregularities will have accompanying
  # `shellcheck disable` statements inline, or in the .shellcheckrc file
  shellcheck -f gcc -s bash "$fname" | sed "s/$fname/ERROR $fname/"

  # Format scripts for whitespace and indents
  shFmt -i 2 -ci -w "$fname"
}

for i in build.sh test.sh precommit; do
  checkFile "$i"
done
